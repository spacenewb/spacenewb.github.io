function getSubtendedHalfAngle(t){return Math.acos(6371.4/(6371.4+t.altitude))}function projectOnMap(t,a){return t([a.longitude,a.latitude])}async function getMapJson(){let t;return await d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")}async function make_map_plot(t,a,e,r,n=!1){let l=await getMapJson();var i=d3.select("#map_plot_svg");i.selectAll("svg").remove();var p=Number(i.attr("ar")),o=i.append("svg"),s=o.node().getBoundingClientRect().width,c=s*p;o.attr("height",s*p);let d=d3.geoEquirectangular().precision(1),u=d3.geoPath().pointRadius(5).projection(d),g=o.selectAll("path").data(l.features);d.fitExtent([[0,0],[s,c]],l),o.append("rect").attr("x",0).attr("y",0).attr("width",s).attr("height",c).attr("class","mapwater"),g.enter().append("path").attr("d",u).attr("class","mapland");let $=d3.geoGraticule()();if(g.enter().append("path").attr("d",u($)).attr("class","mapgraticule"),!0!=n){g.enter().append("circle").attr("r",4).attr("transform","translate("+projectOnMap(d,a)+")").attr("class","satpin blink");let h=d3.geoCircle().center([a.longitude,a.latitude]).radius(180*getSubtendedHalfAngle(a)/Math.PI)();g.enter().append("path").attr("d",u(h)).attr("class","satviewarea"),g.enter().append("circle").attr("r",4).attr("transform","translate("+projectOnMap(d,t)+")").attr("class","sunpin");let m=d3.geoCircle().center([t.longitude,t.latitude]).radius(90)();g.enter().append("path").attr("d",u(m)).attr("class","sunlitarea").attr("fill-opacity",.2),g.enter().append("path").attr("d",u({type:"Feature",geometry:{type:"LineString",coordinates:e}})).attr("class","sattrack"),g.enter().append("circle").attr("r",4).attr("class","pin").attr("transform","translate("+projectOnMap(d,r.location)+")").attr("class","citypin")}}var SunPos={latitude:15,longitude:0},SatCurrLoc={latitude:0,longitude:30,altitude:562.4},SatTrackPath=[[.128,51.5074],[-30,0],[-74.0059,40.7128]],place={name:"Wollongong, Australia",location:{latitude:-34.42507,longitude:150.89315}};make_map_plot(SunPos,SatCurrLoc,SatTrackPath,place,!0);
